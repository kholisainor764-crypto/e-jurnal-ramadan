<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
  <title>e-Jurnal Ramadan ¬∑ Hybrid Edition</title>
  <!-- Font Awesome 6 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <!-- Google Fonts: Inter & Amiri -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* ===== CSS LENGKAP ‚Äì SAMA DENGAN VERSI PREMIUM ===== */
    /* (Saya sertakan semua gaya dari versi sebelumnya, sudah teruji) */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --bg-dark: #0a1f3b;
      --bg-medium: #0d2a4a;
      --bg-light: #123b5e;
      --gold: #ffd966;
      --gold-light: #ffeaa5;
      --gold-soft: #ffb74d;
      --blue-magic: #74b9ff;
      --glass-bg: rgba(10, 30, 50, 0.65);
      --glass-border: rgba(255, 245, 200, 0.2);
      --toast-success: #00b894;
      --toast-error: #d63031;
      --shadow-heavy: 0 20px 40px rgba(0,0,0,0.4);
      --transition: all 0.25s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    body {
      background: radial-gradient(circle at 30% 10%, var(--bg-dark), var(--bg-medium), var(--bg-light));
      color: #f0f9ff;
      font-family: 'Inter', sans-serif;
      line-height: 1.5;
      min-height: 100vh;
      padding: 20px;
      position: relative;
      overflow-x: hidden;
    }
    .moon {
      position: fixed; top: 5%; right: 8%;
      width: 200px; height: 200px;
      background: radial-gradient(circle at 35% 35%, #fffde7, #fff9c4, #ffe082);
      border-radius: 50%;
      box-shadow: 0 0 50px 30px rgba(255,243,158,0.6), 0 0 100px 60px rgba(255,235,120,0.3);
      animation: moonBreathing 7s ease-in-out infinite;
      z-index: 1; opacity: 0.8; pointer-events: none;
    }
    @keyframes moonBreathing {
      0% { box-shadow: 0 0 50px 30px rgba(255,243,158,0.6), 0 0 100px 60px rgba(255,235,120,0.3); transform: scale(1); }
      50% { box-shadow: 0 0 70px 40px rgba(255,255,200,0.9), 0 0 140px 80px rgba(255,241,140,0.5); transform: scale(1.02); }
      100% { box-shadow: 0 0 50px 30px rgba(255,243,158,0.6), 0 0 100px 60px rgba(255,235,120,0.3); transform: scale(1); }
    }
    .stars {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none; z-index: 0;
    }
    .stars::after {
      content: ''; position: absolute;
      width: 4px; height: 4px;
      background: white; border-radius: 50%;
      box-shadow: 80px 120px white, 250px 300px rgba(255,255,200,0.9), 600px 180px white, 900px 70px rgba(255,255,210,0.8),
                  1100px 400px white, 200px 600px rgba(255,255,180,0.7), 700px 550px white, 1300px 200px white,
                  300px 800px white, 1000px 700px rgba(255,255,220,0.9), 400px 450px white, 1200px 550px white;
      animation: twinkle 6s infinite alternate;
    }
    @keyframes twinkle { 0% { opacity: 0.5; } 100% { opacity: 1; } }
    .portal-container {
      position: relative; z-index: 30;
      max-width: 1440px; margin: 0 auto;
      background: var(--glass-bg);
      backdrop-filter: blur(18px);
      border-radius: 56px;
      padding: 30px 35px;
      box-shadow: var(--shadow-heavy);
      border: 1px solid rgba(255,245,200,0.15);
    }
    /* ===== IDENTITY LOGO ===== */
    .identity-logo {
      position: absolute; top: 25px; right: 35px;
      width: 56px; height: 56px;
      border-radius: 50%;
      background: rgba(255,255,245,0.15);
      backdrop-filter: blur(8px);
      border: 2px solid rgba(255,215,100,0.5);
      display: flex; justify-content: center; align-items: center;
      overflow: hidden; box-shadow: 0 0 20px rgba(255,220,100,0.4);
      transition: var(--transition); z-index: 40;
    }
    .identity-logo:hover { transform: scale(1.05); border-color: var(--gold); }
    .identity-logo img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .identity-logo i { font-size: 28px; color: var(--gold); }
    /* ===== HEADER ===== */
    .brand { display: flex; align-items: center; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; }
    .logo-container {
      width: 80px; height: 80px; border-radius: 20px;
      background: rgba(255,255,245,0.1); backdrop-filter: blur(8px);
      border: 2px solid var(--gold); display: flex; justify-content: center; align-items: center;
      overflow: hidden; box-shadow: 0 0 20px rgba(255,220,100,0.3);
    }
    #logoPreview { width: 100%; height: 100%; object-fit: cover; display: block; }
    .logo-placeholder { font-size: 42px; color: var(--gold); }
    .title-tagline h1 { font-size: 2rem; font-weight: 700; color: #fffbe3; text-shadow: 0 0 12px rgba(255,235,100,0.5); margin-bottom: 4px; font-family: 'Amiri', serif; }
    .title-tagline p { font-size: 1rem; color: #e6f7ff; background: rgba(0,0,0,0.2); padding: 5px 18px; border-radius: 50px; display: inline-block; border-left: 6px solid var(--gold-soft); }
    /* ===== INFO RAMADHAN ===== */
    .ramadan-info-card {
      background: rgba(0,0,0,0.2); backdrop-filter: blur(6px); border-radius: 60px;
      padding: 12px 25px; margin-top: 15px; display: inline-flex; align-items: center; gap: 15px; flex-wrap: wrap;
      border: 1px solid rgba(255,215,100,0.3);
    }
    .ramadan-info-card span { display: flex; align-items: center; gap: 8px; color: #ffeaa5; }
    .ramadan-info-card i { color: var(--gold); }
    /* ===== MAIN TABS (BERANDA & PENGATURAN) ===== */
    .main-tab-nav {
      display: flex; gap: 15px;
      margin: 20px 0 20px;
      border-bottom: 1px solid rgba(255,215,100,0.3);
      padding-bottom: 12px;
    }
    .main-tab-btn {
      background: transparent; border: none;
      padding: 12px 32px; font-size: 1rem; font-weight: 600;
      border-radius: 50px; color: #d9e9ff;
      display: flex; align-items: center; gap: 10px;
      cursor: pointer; transition: var(--transition);
      backdrop-filter: blur(6px); border: 1px solid transparent;
    }
    .main-tab-btn i { font-size: 1.1rem; }
    .main-tab-btn.active {
      background: rgba(255,225,140,0.25); color: #ffedb0;
      border: 1px solid var(--gold); box-shadow: 0 0 20px rgba(255,215,0,0.3);
    }
    .main-tab-btn:hover:not(.active) {
      background: rgba(200,230,255,0.15);
      border-color: rgba(255,230,140,0.6);
    }
    .main-tab-content { display: none; animation: fadeSlide 0.35s ease; }
    .main-tab-content.active { display: block; }
    @keyframes fadeSlide {
      0% { opacity: 0; transform: translateY(8px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    /* ===== INNER TABS (SAMBUTAN, TUTORIAL, AKSES, PROFIL) ===== */
    .inner-tab-nav { display: flex; gap: 10px; margin: 15px 0 25px; flex-wrap: wrap; }
    .inner-tab-btn {
      background: rgba(0,0,0,0.3); border: 1px solid rgba(255,215,100,0.3);
      padding: 10px 24px; font-size: 0.95rem; font-weight: 500; border-radius: 40px; color: #e2f0ff;
      display: flex; align-items: center; gap: 8px; cursor: pointer; transition: var(--transition);
    }
    .inner-tab-btn.active {
      background: rgba(255,200,100,0.3); color: #fff4c2; border-color: var(--gold);
      box-shadow: 0 0 15px rgba(255,200,0,0.3);
    }
    .inner-tab-content { display: none; }
    .inner-tab-content.active { display: block; }
    /* ===== SAMBUTAN ===== */
    .ramadan-quote {
      background: linear-gradient(145deg, rgba(20,60,85,0.85), rgba(10,45,65,0.95));
      padding: 30px 35px; border-radius: 60px 20px 60px 20px; margin-bottom: 20px;
      border-left: 12px solid var(--gold-soft); backdrop-filter: blur(8px);
    }
    .ramadan-quote h2 { font-size: 2.2rem; font-family: 'Amiri', serif; color: var(--gold-light); margin-bottom: 8px; }
    .ramadan-quote p { font-size: 1.2rem; font-style: italic; color: #f0fff0; }
    .welcome-principal {
      display: flex; gap: 30px; flex-wrap: wrap; background: rgba(25,65,90,0.65); border-radius: 48px;
      padding: 25px; align-items: center; backdrop-filter: blur(8px);
      border: 1px solid rgba(255,200,120,0.3);
    }
    .principal-photo {
      width: 130px; height: 130px; border-radius: 50%;
      background: radial-gradient(circle, #ffe082, #ffb74d);
      display: flex; justify-content: center; align-items: center;
      font-size: 70px; color: #1e3b5a; border: 4px solid var(--gold);
      box-shadow: 0 0 30px #ffd966aa; overflow: hidden;
    }
    .speech { flex: 1; }
    .speech h3 { font-size: 1.8rem; color: #ffddaa; border-bottom: 2px dashed #fff3cd; padding-bottom: 10px; margin-bottom: 15px; }
    .speech p { font-size: 1.1rem; color: #f5f6fa; line-height: 1.7; }
    /* ===== VIDEO TUTORIAL ===== */
    .video-card {
      display: flex; align-items: center; gap: 30px; background: rgba(15,50,70,0.75); border-radius: 36px;
      padding: 20px 30px; flex-wrap: wrap; backdrop-filter: blur(8px);
      border: 1px solid rgba(255,220,100,0.3);
    }
    .video-frame { width: 280px; height: 158px; border-radius: 20px; overflow: hidden; box-shadow: 0 0 0 4px rgba(255,220,100,0.3); }
    .video-frame iframe { width: 100%; height: 100%; border: none; }
    .video-text h4 { font-size: 1.6rem; margin-bottom: 10px; color: #fff2bf; }
    /* ===== CARD GRID ===== */
    .filter-section { display: flex; align-items: center; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; }
    .filter-select {
      background: rgba(10,35,55,0.85); border: 1px solid var(--gold);
      color: white; padding: 10px 25px; border-radius: 40px;
      font-size: 0.95rem; cursor: pointer; transition: var(--transition);
    }
    .class-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 20px; margin-bottom: 25px;
    }
    .class-card {
      background: rgba(0,0,0,0.35); backdrop-filter: blur(8px); border-radius: 28px;
      padding: 20px; border: 1px solid rgba(255,215,100,0.3);
      transition: var(--transition); box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }
    .class-card:hover {
      border-color: var(--gold); background: rgba(0,0,0,0.45); transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.3);
    }
    .class-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 1px dashed rgba(255,215,100,0.5); }
    .class-header h3 { font-size: 1.5rem; font-weight: 700; color: #ffefc0; }
    .class-header i { font-size: 1.8rem; color: var(--gold); }
    .rombel-links-card { display: flex; flex-direction: column; gap: 12px; }
    .rombel-item { display: flex; justify-content: space-between; align-items: center; padding: 6px 0; }
    .rombel-label { font-weight: 600; color: #fbffc4; min-width: 75px; }
    .rombel-actions { display: flex; gap: 12px; }
    .btn-link {
      display: inline-flex; align-items: center; gap: 6px; padding: 6px 16px; border-radius: 30px;
      font-size: 0.85rem; text-decoration: none; font-weight: 500; transition: var(--transition);
    }
    .btn-sheet { background: rgba(70,130,200,0.25); border: 1px solid var(--blue-magic); color: #cfe9ff; }
    .btn-sheet:hover { background: #0984e3; color: white; transform: scale(1.02); }
    .btn-canva { background: rgba(180,70,200,0.25); border: 1px solid #e08eff; color: #e6d0ff; }
    .btn-canva:hover { background: #8e44ad; color: white; transform: scale(1.02); }
    .btn-canva-primary {
      background: radial-gradient(circle at 30% 30%, #ffb347, #ff8c42);
      padding: 16px 50px; border-radius: 60px; font-size: 1.3rem; font-weight: 700; color: #0a1f2e;
      border: 2px solid #ffe99b; box-shadow: 0 0 30px #ffb347cc; display: inline-flex; gap: 15px; align-items: center;
      text-decoration: none; margin: 10px 0; transition: var(--transition);
    }
    .btn-canva-primary:hover { background: radial-gradient(circle at 30% 30%, #ffa233, #ff6b2b); box-shadow: 0 0 50px #ffae42; transform: scale(1.03); }
    /* ===== FOOTER ===== */
    .footer {
      background: rgba(6,25,40,0.85); border-radius: 40px; padding: 25px 30px;
      display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; margin-top: 15px;
      backdrop-filter: blur(8px);
    }
    .footer-logo { display: flex; align-items: center; gap: 15px; }
    .footer-info h4 { font-size: 1.5rem; color: #fff3cd; }
    .social a { color: #ffe9b0; font-size: 28px; margin-left: 20px; transition: var(--transition); display: inline-block; }
    .social a:hover { color: var(--gold); transform: translateY(-4px); }
    .copyright { text-align: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(255,215,100,0.3); color: #c3e6ff; font-size: 0.9rem; }
    /* ===== PANEL PENGATURAN (MODAL & HALAMAN) ===== */
    .settings-panel {
      background: rgba(7,35,50,0.9); backdrop-filter: blur(20px);
      padding: 30px; border-radius: 48px;
      border: 1px solid rgba(255,215,100,0.3);
    }
    .setting-group {
      background: rgba(255,255,255,0.07); border-radius: 32px;
      padding: 25px; margin-bottom: 25px;
      border: 1px solid rgba(255,215,100,0.1);
    }
    .setting-group h3 { color: #ffe189; margin-bottom: 20px; font-size: 1.5rem; display: flex; align-items: center; gap: 10px; }
    .field { display: flex; flex-wrap: wrap; align-items: center; gap: 15px; margin-bottom: 20px; }
    .field label { width: 180px; font-weight: 600; color: #fff0d0; }
    .field input {
      flex: 1; padding: 12px 22px; background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,200,100,0.3); border-radius: 60px; color: white;
    }
    .btn-primary, .btn-warning, .btn-secondary {
      padding: 12px 30px; border-radius: 60px; font-weight: 700; cursor: pointer; border: none;
      display: inline-flex; align-items: center; gap: 10px; transition: var(--transition);
    }
    .btn-primary { background: #f39c12; color: #0a1e2b; }
    .btn-primary:hover { background: #e67e22; box-shadow: 0 0 20px #ffb347; }
    .btn-warning { background: #e74c3c; color: white; }
    .btn-warning:hover { background: #c0392b; }
    .btn-secondary { background: rgba(255,255,255,0.12); color: #ffd966; border: 1px solid #ffd966; }
    /* ===== MODAL ===== */
    .modal-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.85); backdrop-filter: blur(12px);
      display: flex; justify-content: center; align-items: center;
      z-index: 999999; visibility: hidden; opacity: 0;
      transition: opacity 0.3s ease, visibility 0.3s;
    }
    .modal-overlay.active { visibility: visible; opacity: 1; }
    .modal-card {
      background: linear-gradient(145deg, rgba(12,40,60,0.95), rgba(8,30,45,0.98));
      backdrop-filter: blur(20px);
      border: 2px solid var(--gold); border-radius: 48px;
      padding: 40px; max-width: 460px; width: 90%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
      transform: scale(0.95); transition: transform 0.3s;
      text-align: center;
    }
    .modal-overlay.active .modal-card { transform: scale(1); }
    .modal-icon-wrapper { margin-bottom: 20px; }
    .modal-lock-icon { font-size: 56px; color: var(--gold); animation: lockPulse 3s infinite; }
    @keyframes lockPulse { 0%,100% { transform: scale(1); } 50% { transform: scale(1.05); } }
    .modal-title { font-family: 'Amiri', serif; font-size: 2rem; color: var(--gold-light); margin-bottom: 8px; }
    .modal-subtitle { color: #cfe9ff; margin-bottom: 30px; }
    .input-group { position: relative; margin-bottom: 30px; }
    .input-icon { position: absolute; left: 18px; top: 50%; transform: translateY(-50%); color: var(--gold); }
    .modal-input {
      width: 100%; padding: 16px 20px 16px 50px;
      background: rgba(0,0,0,0.4); border: 1.5px solid rgba(255,215,100,0.5);
      border-radius: 60px; color: white; font-size: 1rem;
    }
    .modal-input:focus { border-color: var(--gold); box-shadow: 0 0 0 4px rgba(255,215,0,0.2); outline: none; }
    .modal-actions { display: flex; gap: 15px; justify-content: center; }
    .modal-btn {
      padding: 12px 30px; border-radius: 60px; font-weight: 600; cursor: pointer; border: none;
      display: inline-flex; align-items: center; gap: 10px; transition: 0.2s;
    }
    .modal-btn-primary { background: var(--gold); color: #0a1f3b; }
    .modal-btn-secondary { background: rgba(255,255,255,0.1); color: white; border: 1px solid white; }
    .modal-hint { color: #aad8ff; font-size: 0.85rem; margin-top: 20px; border-top: 1px dashed rgba(255,215,100,0.3); padding-top: 15px; }
    .password-strength { display: flex; align-items: center; gap: 15px; margin: 15px 0; }
    .strength-bar { width: 100px; height: 6px; background: rgba(255,255,255,0.2); border-radius: 10px; }
    .strength-fill { height: 100%; width: 0; border-radius: 10px; }
    /* ===== TOAST ===== */
    #toast {
      visibility: hidden; min-width: 300px;
      background: var(--toast-success); color: white;
      border-radius: 60px; padding: 16px 28px;
      position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
      z-index: 9999999; display: flex; align-items: center; gap: 12px;
      backdrop-filter: blur(8px); box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }
    #toast.show { visibility: visible; animation: fadein 0.4s, fadeout 0.4s 3s; }
    @keyframes fadein { from { bottom: 0; opacity: 0; } to { bottom: 30px; opacity: 1; } }
    @keyframes fadeout { from { bottom: 30px; opacity: 1; } to { bottom: 0; opacity: 0; } }
    /* ===== CANVA EMBED MODAL ===== */
    .canva-modal-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.85); backdrop-filter: blur(12px);
      display: flex; justify-content: center; align-items: center;
      z-index: 999999; visibility: hidden; opacity: 0; transition: 0.3s;
    }
    .canva-modal-overlay.active { visibility: visible; opacity: 1; }
    .canva-modal-container {
      width: 90%; height: 85%; max-width: 1200px;
      background: rgba(10,30,45,0.95); backdrop-filter: blur(20px);
      border: 2px solid rgba(255,215,100,0.6); border-radius: 32px;
      display: flex; flex-direction: column; overflow: hidden;
      transform: scale(0.95); transition: transform 0.3s;
    }
    .canva-modal-overlay.active .canva-modal-container { transform: scale(1); }
    .canva-modal-header {
      display: flex; justify-content: space-between; align-items: center;
      padding: 16px 24px; border-bottom: 1px solid rgba(255,215,100,0.3);
    }
    .canva-modal-header h3 { font-family: 'Amiri', serif; color: #ffeaa5; font-size: 1.5rem; display: flex; align-items: center; gap: 10px; }
    .canva-close-btn {
      background: rgba(255,255,255,0.1); border: 1px solid rgba(255,215,100,0.5);
      color: #ffd966; width: 40px; height: 40px; border-radius: 50%;
      display: flex; justify-content: center; align-items: center; font-size: 1.3rem; cursor: pointer;
    }
    .canva-close-btn:hover { background: rgba(255,200,100,0.2); border-color: var(--gold); transform: rotate(90deg); }
    .canva-iframe-wrapper { flex: 1; width: 100%; padding: 20px; position: relative; }
    .canva-iframe-wrapper iframe { width: 100%; height: 100%; border: none; border-radius: 20px; background: white; }
    .canva-loading {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      color: #ffd966; font-size: 1.2rem; display: flex; flex-direction: column; align-items: center; gap: 12px;
    }
    .canva-loading i { font-size: 3rem; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    @media (max-width: 1000px) {
      .portal-container { padding: 20px; }
      .moon { width: 130px; height: 130px; }
      .identity-logo { top: 15px; right: 20px; width: 48px; height: 48px; }
    }
  </style>
</head>
<body>
  <div class="moon"></div>
  <div class="stars"></div>
  <div id="toast"><i class="fas fa-check-circle"></i> <span id="toast-message">Berhasil</span></div>

  <!-- MODAL PASSWORD PENGATURAN -->
  <div id="passwordModal" class="modal-overlay">
    <div class="modal-card">
      <div class="modal-icon-wrapper"><i class="fas fa-lock modal-lock-icon"></i></div>
      <h2 class="modal-title">Akses Pengaturan</h2>
      <p class="modal-subtitle">Masukkan password administrator</p>
      <div class="input-group">
        <span class="input-icon"><i class="fas fa-key"></i></span>
        <input type="password" id="modalPasswordInput" class="modal-input" placeholder="Password">
      </div>
      <div class="modal-actions">
        <button class="modal-btn modal-btn-primary" id="modalSubmitBtn"><i class="fas fa-key"></i> Buka</button>
        <button class="modal-btn modal-btn-secondary" id="modalCancelBtn"><i class="fas fa-times"></i> Batal</button>
      </div>
      <p class="modal-hint"><i class="fas fa-info-circle"></i> Default: <strong>demo123</strong></p>
    </div>
  </div>

  <!-- MODAL KONFIRMASI -->
  <div id="confirmModal" class="modal-overlay">
    <div class="modal-card">
      <i class="fas fa-question-circle" style="font-size:56px; color:var(--gold);"></i>
      <h2 class="modal-title" id="confirmTitle">Konfirmasi</h2>
      <p id="confirmMessage" style="color:white; margin-bottom:25px;"></p>
      <div class="modal-actions">
        <button class="modal-btn modal-btn-primary" id="confirmOkBtn"><i class="fas fa-check"></i> Ya</button>
        <button class="modal-btn modal-btn-secondary" id="confirmCancelBtn"><i class="fas fa-times"></i> Batal</button>
      </div>
    </div>
  </div>

  <!-- CANVA EMBED MODAL -->
  <div id="canvaModal" class="canva-modal-overlay">
    <div class="canva-modal-container">
      <div class="canva-modal-header">
        <h3><i class="fab fa-canva"></i> Canva e‚ÄëJurnal Ramadan</h3>
        <div class="canva-close-btn" id="closeCanvaModal"><i class="fas fa-times"></i></div>
      </div>
      <div class="canva-iframe-wrapper">
        <div id="canvaLoading" class="canva-loading"><i class="fas fa-circle-notch"></i><span>Memuat desain Canva...</span></div>
        <iframe id="canvaIframe" src="about:blank" allowfullscreen style="display: none;"></iframe>
      </div>
    </div>
  </div>

  <div id="appRoot"></div>

  <script>
    (function() {
      'use strict';

      // üîÅ ========== [ GANTI URL INI DENGAN URL PUBLISH GOOGLE SHEETS ANDA ] ==========
      const SHEET_JSON_URL = 'https://spreadsheets.google.com/feeds/list/1xJ_6k8D7c7zQy9UqWm0VnXr5zL3tHfGpP/od6/public/values?alt=json';
      // üîº GANTI DENGAN URL PUBLISH ANDA!

      // ---------- KONSTANTA ----------
      const KELAS_LIST = [1,2,3,4,5,6];
      const HURUF_ROMBEL = ['A','B','C','D'];
      const AUTH_SESSION_KEY = 'eJurnal_adminAuth';

      // ---------- STATE ----------
      let sheetData = {
        general: {},
        gsheetLinks: {},
        canvaLinks: {},
        identityLogo: null,
        identityIcon: 'fas fa-star'
      };

      let adminSettings = {
        password: 'demo123'
      };

      // ---------- UTILS ----------
      function showToast(msg, type = 'success') {
        const toast = document.getElementById('toast');
        document.getElementById('toast-message').textContent = msg;
        toast.style.background = type === 'success' ? '#00b894' : type === 'error' ? '#d63031' : '#fdcb6e';
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 3300);
      }

      function isAuthenticated() {
        return sessionStorage.getItem(AUTH_SESSION_KEY) === 'true';
      }

      function setAuthenticated(value) {
        if (value) sessionStorage.setItem(AUTH_SESSION_KEY, 'true');
        else sessionStorage.removeItem(AUTH_SESSION_KEY);
      }

      // ---------- LOAD ADMIN PASSWORD FROM LOCALSTORAGE ----------
      function loadAdminSettings() {
        const stored = localStorage.getItem('eJurnal_adminSettings');
        if (stored) {
          try {
            const parsed = JSON.parse(stored);
            adminSettings = { ...adminSettings, ...parsed };
          } catch(e) {}
        }
      }
      function saveAdminSettings() {
        localStorage.setItem('eJurnal_adminSettings', JSON.stringify(adminSettings));
      }

      // ---------- FETCH DATA FROM GOOGLE SHEETS ----------
      async function fetchSheetData() {
        try {
          const response = await fetch(SHEET_JSON_URL);
          if (!response.ok) throw new Error('Gagal memuat data');
          const data = await response.json();
          const entries = data.feed.entry || [];

          // Reset
          sheetData = {
            general: {},
            gsheetLinks: {},
            canvaLinks: {},
            identityLogo: null,
            identityIcon: 'fas fa-star'
          };

          entries.forEach(entry => {
            const key = entry.title?.$t;
            const value = entry.content?.$t || '';
            if (!key) return;

            if (key.startsWith('class_')) {
              const parts = key.split('_');
              if (parts.length === 3) {
                const kelasHuruf = parts[1];
                const type = parts[2];
                if (type === 'sheet') sheetData.gsheetLinks[kelasHuruf] = value || '#';
                if (type === 'canva') sheetData.canvaLinks[kelasHuruf] = value || '#';
              }
            } else {
              sheetData.general[key] = value;
            }
          });

          // Fallback
          KELAS_LIST.forEach(k => {
            HURUF_ROMBEL.forEach(h => {
              const key = `${k}${h}`;
              if (!sheetData.gsheetLinks[key]) sheetData.gsheetLinks[key] = '#';
              if (!sheetData.canvaLinks[key]) sheetData.canvaLinks[key] = '#';
            });
          });

          renderApp();
        } catch (error) {
          console.error(error);
          renderApp(); // tetap render dengan data kosong (default)
        }
      }

      // ---------- RENDER UTAMA ----------
      function renderApp() {
        const gen = sheetData.general;
        const html = `
          <div class="portal-container">
            <!-- IDENTITY LOGO -->
            <div id="identityLogoContainer" class="identity-logo">
              ${gen.identity_logo 
                ? `<img src="${gen.identity_logo}" alt="logo identitas">`
                : `<i class="${gen.identity_icon || 'fas fa-star'}"></i>`
              }
            </div>

            <!-- HEADER -->
            <div class="brand">
              <div class="logo-container">
                <div class="logo-placeholder"><i class="fas fa-mosque"></i></div>
              </div>
              <div class="title-tagline">
                <h1>${gen.school_name || 'e-Jurnal Ramadan 1446 H'}</h1>
                <p>${gen.school_tagline || '‚ú® Cahaya Ilmu di Bulan Suci ‚ú®'}</p>
              </div>
            </div>

            <!-- MAIN TABS (BERANDA & PENGATURAN) -->
            <div class="main-tab-nav">
              <button class="main-tab-btn active" id="mainTabHome"><i class="fas fa-home"></i> Beranda</button>
              <button class="main-tab-btn" id="mainTabSettings"><i class="fas fa-sliders-h"></i> Pengaturan</button>
            </div>

            <!-- KONTEN BERANDA -->
            <div id="homeContent" class="main-tab-content active">
              <!-- INNER TABS -->
              <div class="inner-tab-nav">
                <button class="inner-tab-btn active" id="tabSambutan"><i class="fas fa-star"></i> Sambutan</button>
                <button class="inner-tab-btn" id="tabTutorial"><i class="fas fa-video"></i> Tutorial</button>
                <button class="inner-tab-btn" id="tabAkses"><i class="fas fa-users"></i> User Siswa & Ortu</button>
                <button class="inner-tab-btn" id="tabProfil"><i class="fas fa-address-card"></i> Profil Sekolah</button>
              </div>

              <!-- SAMBUTAN -->
              <div id="contentSambutan" class="inner-tab-content active">
                <div class="ramadan-quote">
                  <h2>üåô Marhaban Ya Ramadan</h2>
                  <p>"Bulan yang penuh berkah, pintu ampunan terbuka lebar. Mari isi dengan e-Jurnal kebaikan."</p>
                  <div id="ramadanInfo" class="ramadan-info-card">
                    ${renderRamadanInfo(gen.ramadan_start)}
                  </div>
                </div>
                <div class="welcome-principal">
                  <div class="principal-photo">
                    <div style="font-size:70px;"><i class="${gen.principal_icon || 'fas fa-user-tie'}"></i></div>
                  </div>
                  <div class="speech">
                    <h3>Sambutan Kepala Sekolah</h3>
                    <p>${gen.speech || 'Selamat menunaikan ibadah puasa. Mari kita isi Ramadan dengan kebaikan.'}</p>
                    <p style="margin-top: 12px;"><strong>‚Äì ${gen.principal_name || 'Kepala Sekolah'}</strong></p>
                  </div>
                </div>
              </div>

              <!-- TUTORIAL -->
              <div id="contentTutorial" class="inner-tab-content">
                <div class="video-card">
                  <div class="video-frame">
                    <iframe src="https://www.youtube.com/embed/${gen.youtube_id || 'VIDEO_ID'}?controls=1&rel=0" allowfullscreen></iframe>
                  </div>
                  <div class="video-text">
                    <h4>Tutorial Penggunaan APP</h4>
                    <p>Panduan lengkap e-Jurnal untuk guru, siswa & ortu.</p>
                    <span style="color: #ffeaa5;"><i class="fas fa-video"></i> Klik putar untuk menonton</span>
                  </div>
                </div>
              </div>

              <!-- AKSES KELAS -->
              <div id="contentAkses" class="inner-tab-content">
                <div class="filter-section">
                  <label><i class="fas fa-filter"></i> Filter Kelas:</label>
                  <select id="filterKelas" class="filter-select">
                    <option value="all">Semua Kelas</option>
                    <option value="1">Kelas 1</option>
                    <option value="2">Kelas 2</option>
                    <option value="3">Kelas 3</option>
                    <option value="4">Kelas 4</option>
                    <option value="5">Kelas 5</option>
                    <option value="6">Kelas 6</option>
                  </select>
                </div>
                <div id="classGridContainer" class="class-grid">
                  ${renderClassGrid('all')}
                </div>
                <div style="text-align: center;">
                  <a href="${gen.main_canva_url || '#'}" id="mainCanvaLink" class="btn-canva-primary" target="_blank">
                    <i class="fab fa-canva"></i> Aplikasi Utama Canva
                  </a>
                </div>
              </div>

              <!-- PROFIL SEKOLAH -->
              <div id="contentProfil" class="inner-tab-content">
                <footer class="footer" style="margin-top:0;">
                  <div class="footer-logo">
                    <i class="fas fa-mosque" style="font-size: 50px; color: #ffe087;"></i>
                    <div class="footer-info">
                      <h4>${gen.footer_school || 'SDIT Al-Falah'}</h4>
                      <span>${gen.footer_tagline || 'Bersama Raih Berkah Ramadan'}</span>
                      <span><i class="fas fa-map-marker-alt"></i> ${gen.footer_address || 'Jl. Luminous No. 9, Jakarta'}</span>
                    </div>
                  </div>
                  <div class="social">
                    <a href="${gen.ig_url || '#'}" target="_blank"><i class="fab fa-instagram"></i></a>
                    <a href="${gen.fb_url || '#'}" target="_blank"><i class="fab fa-facebook"></i></a>
                    <a href="${gen.yt_url || '#'}" target="_blank"><i class="fab fa-youtube"></i></a>
                    <a href="${gen.tiktok_url || '#'}" target="_blank"><i class="fab fa-tiktok"></i></a>
                  </div>
                </footer>
                <div class="copyright">${gen.copyright_text || '¬© SDIT Al-Falah 2026'}</div>
              </div>
            </div>

            <!-- KONTEN PENGATURAN (PROTECTED) -->
            <div id="settingsContent" class="main-tab-content">
              <div class="settings-panel">
                <h2 style="color:#ffe08c; margin-bottom:20px;"><i class="fas fa-cog"></i> Pengaturan Admin</h2>
                
                <!-- KEAMANAN & AKSES -->
                <div class="setting-group">
                  <h3><i class="fas fa-shield-alt"></i> üîê Keamanan & Akses</h3>
                  <div class="field">
                    <label>Password Saat Ini</label>
                    <input type="password" id="currentPassword" placeholder="Masukkan password lama">
                  </div>
                  <div class="field">
                    <label>Password Baru</label>
                    <input type="password" id="newPassword" placeholder="Minimal 6 karakter">
                  </div>
                  <div class="field">
                    <label>Konfirmasi Password</label>
                    <input type="password" id="confirmPassword" placeholder="Ulangi password baru">
                  </div>
                  <div class="password-strength">
                    <span>Kekuatan:</span>
                    <div class="strength-bar"><div id="strengthFill" class="strength-fill"></div></div>
                    <span id="strengthText">Lemah</span>
                  </div>
                  <div style="display: flex; gap: 15px; margin-top: 20px;">
                    <button class="btn-primary" id="changePasswordBtn"><i class="fas fa-save"></i> Perbarui Password</button>
                    <button class="btn-warning" id="logoutSettingsBtn"><i class="fas fa-sign-out-alt"></i> Logout</button>
                  </div>
                  <p style="color: #ffd966; margin-top: 15px;"><i class="fas fa-info-circle"></i> Password default: <strong>demo123</strong></p>
                </div>

                <!-- INFORMASI -->
                <div class="setting-group">
                  <h3><i class="fas fa-info-circle"></i> Tentang Aplikasi</h3>
                  <p style="color: #e6f7ff; margin-bottom: 10px;">
                    <i class="fas fa-check-circle" style="color: #00b894;"></i> <strong>Mode Hybrid:</strong> Data konten bersumber dari Google Sheets (realtime), pengaturan admin disimpan di browser.
                  </p>
                  <p style="color: #e6f7ff;">
                    <i class="fas fa-cloud-upload-alt"></i> Untuk mengubah konten (nama sekolah, tautan kelas, dll), edit Google Sheets Anda.
                  </p>
                </div>
              </div>
            </div>
          </div>
        `;

        document.getElementById('appRoot').innerHTML = html;
        attachEventListeners();
      }

      // ---------- RENDER CARD GRID ----------
      function renderClassGrid(filterKelas = 'all') {
        let html = '';
        KELAS_LIST.forEach(kelas => {
          if (filterKelas !== 'all' && kelas != filterKelas) return;
          html += `<div class="class-card">
            <div class="class-header"><h3>Kelas ${kelas}</h3><i class="fas fa-users"></i></div>
            <div class="rombel-links-card">`;
          HURUF_ROMBEL.forEach(huruf => {
            const key = `${kelas}${huruf}`;
            const sheetLink = sheetData.gsheetLinks[key] || '#';
            const canvaLink = sheetData.canvaLinks[key] || '#';
            html += `<div class="rombel-item">
              <span class="rombel-label">Kelas ${key}</span>
              <div class="rombel-actions">
                <a href="${sheetLink}" class="btn-link btn-sheet" target="_blank"><i class="fas fa-file-excel"></i> Sheet</a>
                <a href="${canvaLink}" class="btn-link btn-canva" target="_blank"><i class="fab fa-canva"></i> Canva</a>
              </div>
            </div>`;
          });
          html += `</div></div>`;
        });
        return html;
      }

      // ---------- RENDER INFO RAMADHAN ----------
      function renderRamadanInfo(startDateStr) {
        if (!startDateStr) startDateStr = '2026-03-01';
        const startDate = new Date(startDateStr + 'T12:00:00');
        const today = new Date();
        today.setHours(0,0,0,0);
        const diffTime = today - startDate;
        const diffDays = Math.floor(diffTime / (1000*60*60*24)) + 1;
        const formatted = startDate.toLocaleDateString('id-ID', { day:'numeric', month:'long', year:'numeric' });
        let html = `<span><i class="fas fa-calendar-alt"></i> 1 Ramadhan 1446 H: ${formatted}</span>`;
        if (diffDays > 0) {
          html += `<span><i class="fas fa-moon"></i> Hari ke-${diffDays} Ramadhan 1446 H</span>`;
        } else {
          html += `<span><i class="fas fa-moon"></i> Menjelang Ramadhan 1446 H</span>`;
        }
        return html;
      }

      // ---------- ATTACH EVENT LISTENERS ----------
      function attachEventListeners() {
        // ---------- MAIN TABS ----------
        const homeBtn = document.getElementById('mainTabHome');
        const settingsBtn = document.getElementById('mainTabSettings');
        const homeContent = document.getElementById('homeContent');
        const settingsContent = document.getElementById('settingsContent');

        homeBtn.addEventListener('click', function() {
          homeBtn.classList.add('active');
          settingsBtn.classList.remove('active');
          homeContent.classList.add('active');
          settingsContent.classList.remove('active');
        });

        settingsBtn.addEventListener('click', function(e) {
          e.preventDefault();
          if (isAuthenticated()) {
            // Langsung buka settings
            settingsBtn.classList.add('active');
            homeBtn.classList.remove('active');
            settingsContent.classList.add('active');
            homeContent.classList.remove('active');
          } else {
            // Tampilkan modal password
            showPasswordModal();
          }
        });

        // ---------- INNER TABS ----------
        const innerBtns = {
          tabSambutan: 'contentSambutan',
          tabTutorial: 'contentTutorial',
          tabAkses: 'contentAkses',
          tabProfil: 'contentProfil'
        };
        for (let [btnId, contentId] of Object.entries(innerBtns)) {
          const btn = document.getElementById(btnId);
          if (btn) {
            btn.addEventListener('click', function() {
              Object.values(innerBtns).forEach(id => document.getElementById(id).classList.remove('active'));
              document.getElementById(contentId).classList.add('active');
              document.querySelectorAll('.inner-tab-btn').forEach(b => b.classList.remove('active'));
              this.classList.add('active');
            });
          }
        }

        // ---------- FILTER KELAS ----------
        const filterSelect = document.getElementById('filterKelas');
        if (filterSelect) {
          filterSelect.addEventListener('change', function(e) {
            document.getElementById('classGridContainer').innerHTML = renderClassGrid(e.target.value);
          });
        }

        // ---------- CANVA EMBED ----------
        attachCanvaListeners();

        // ---------- PASSWORD MODAL ----------
        // (sudah didefinisikan di bawah)
      }

      // ---------- PASSWORD MODAL ----------
      const passwordModal = document.getElementById('passwordModal');
      const modalInput = document.getElementById('modalPasswordInput');
      const modalSubmit = document.getElementById('modalSubmitBtn');
      const modalCancel = document.getElementById('modalCancelBtn');

      function showPasswordModal() {
        passwordModal.classList.add('active');
        modalInput.value = '';
        modalInput.focus();
      }
      function hidePasswordModal() {
        passwordModal.classList.remove('active');
      }

      modalSubmit.addEventListener('click', function() {
        const pwd = modalInput.value;
        if (pwd === adminSettings.password) {
          setAuthenticated(true);
          hidePasswordModal();
          // Buka tab pengaturan
          document.getElementById('mainTabSettings').click();
          showToast('Akses diberikan', 'success');
        } else {
          showToast('Password salah!', 'error');
          modalInput.value = '';
          modalInput.focus();
        }
      });
      modalCancel.addEventListener('click', hidePasswordModal);
      modalInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') modalSubmit.click();
      });

      // ---------- LOGOUT ----------
      document.addEventListener('click', function(e) {
        if (e.target.id === 'logoutSettingsBtn' || e.target.closest('#logoutSettingsBtn')) {
          const btn = e.target.closest('#logoutSettingsBtn');
          if (btn) {
            showConfirmModal('Logout', 'Anda akan keluar dari Pengaturan. Lanjutkan?', 'fas fa-sign-out-alt', function() {
              setAuthenticated(false);
              document.getElementById('mainTabHome').click();
              showToast('Anda telah logout', 'success');
            });
          }
        }
      });

      // ---------- GANTI PASSWORD ----------
      document.addEventListener('click', function(e) {
        if (e.target.id === 'changePasswordBtn' || e.target.closest('#changePasswordBtn')) {
          const current = document.getElementById('currentPassword').value;
          const newPwd = document.getElementById('newPassword').value;
          const confirm = document.getElementById('confirmPassword').value;
          if (current !== adminSettings.password) {
            showToast('Password saat ini salah!', 'error');
            return;
          }
          if (newPwd.length < 6) {
            showToast('Password baru minimal 6 karakter', 'error');
            return;
          }
          if (newPwd !== confirm) {
            showToast('Konfirmasi password tidak cocok', 'error');
            return;
          }
          adminSettings.password = newPwd;
          saveAdminSettings();
          showToast('Password berhasil diperbarui!', 'success');
          document.getElementById('currentPassword').value = '';
          document.getElementById('newPassword').value = '';
          document.getElementById('confirmPassword').value = '';
          updateStrengthIndicator('');
        }
      });

      // ---------- PASSWORD STRENGTH ----------
      function updateStrengthIndicator(pwd) {
        const fill = document.getElementById('strengthFill');
        const text = document.getElementById('strengthText');
        if (!fill || !text) return;
        if (pwd.length < 6) {
          fill.style.width = '20%'; fill.style.background = '#e74c3c'; text.innerText = 'Lemah (min 6)';
        } else {
          let strength = 0;
          if (pwd.length >= 8) strength++;
          if (/[a-z]/.test(pwd) && /[A-Z]/.test(pwd)) strength++;
          if (/[0-9]/.test(pwd)) strength++;
          if (/[^a-zA-Z0-9]/.test(pwd)) strength++;
          if (strength <= 1) {
            fill.style.width = '33%'; fill.style.background = '#e74c3c'; text.innerText = 'Lemah';
          } else if (strength === 2) {
            fill.style.width = '66%'; fill.style.background = '#f39c12'; text.innerText = 'Sedang';
          } else {
            fill.style.width = '100%'; fill.style.background = '#00b894'; text.innerText = 'Kuat';
          }
        }
      }
      document.addEventListener('input', function(e) {
        if (e.target.id === 'newPassword') updateStrengthIndicator(e.target.value);
      });

      // ---------- CONFIRM MODAL ----------
      const confirmModal = document.getElementById('confirmModal');
      const confirmTitle = document.getElementById('confirmTitle');
      const confirmMessage = document.getElementById('confirmMessage');
      const confirmOkBtn = document.getElementById('confirmOkBtn');
      const confirmCancelBtn = document.getElementById('confirmCancelBtn');
      let confirmCallback = null;

      function showConfirmModal(title, message, icon, callback) {
        confirmTitle.innerText = title;
        confirmMessage.innerText = message;
        confirmModal.classList.add('active');
        confirmCallback = callback;
      }
      function hideConfirmModal() { confirmModal.classList.remove('active'); confirmCallback = null; }
      confirmOkBtn.addEventListener('click', function() { if (confirmCallback) confirmCallback(); hideConfirmModal(); });
      confirmCancelBtn.addEventListener('click', hideConfirmModal);

      // ---------- CANVA EMBED ----------
      function attachCanvaListeners() {
        const canvaModal = document.getElementById('canvaModal');
        const canvaIframe = document.getElementById('canvaIframe');
        const canvaLoading = document.getElementById('canvaLoading');
        const closeBtn = document.getElementById('closeCanvaModal');

        function buildCanvaEmbedUrl(url) {
          if (!url || url === '#') return null;
          try {
            if (url.includes('/embed')) return url;
            const designMatch = url.match(/(https:\/\/[^\/]+\/design\/[^\/?#]+)/i);
            if (designMatch) {
              let base = designMatch[1];
              base = base.replace(/\/[^\/]+$/, '');
              return `${base}/embed?referer=e-jurnal-ramadan`;
            }
            return url.endsWith('/') ? `${url}embed` : `${url}/embed`;
          } catch (e) { return null; }
        }

        function openCanvaEmbed(originalUrl) {
          const embedUrl = buildCanvaEmbedUrl(originalUrl);
          if (!embedUrl) { window.open(originalUrl, '_blank'); return; }
          canvaLoading.style.display = 'flex';
          canvaIframe.style.display = 'none';
          canvaIframe.src = embedUrl;
          canvaModal.classList.add('active');
          document.body.style.overflow = 'hidden';
          canvaIframe.onload = () => {
            canvaLoading.style.display = 'none';
            canvaIframe.style.display = 'block';
          };
        }

        function closeCanvaEmbed() {
          canvaModal.classList.remove('active');
          document.body.style.overflow = '';
          setTimeout(() => { if (!canvaModal.classList.contains('active')) canvaIframe.src = 'about:blank'; }, 300);
        }

        closeBtn.addEventListener('click', closeCanvaEmbed);
        canvaModal.addEventListener('click', e => { if (e.target === canvaModal) closeCanvaEmbed(); });
        document.addEventListener('keydown', e => { if (e.key === 'Escape' && canvaModal.classList.contains('active')) closeCanvaEmbed(); });

        document.querySelectorAll('.btn-canva').forEach(btn => {
          btn.addEventListener('click', function(e) {
            e.preventDefault();
            openCanvaEmbed(this.href);
          });
        });

        const mainCanva = document.getElementById('mainCanvaLink');
        if (mainCanva) {
          mainCanva.addEventListener('click', function(e) {
            e.preventDefault();
            openCanvaEmbed(this.href);
          });
        }
      }

      // ---------- INIT ----------
      loadAdminSettings();
      fetchSheetData();
    })();
  </script>
</body>
</html>
