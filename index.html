<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
  <title>e-Jurnal Ramadan ¬∑ Google Sheets Edition</title>
  <!-- Font Awesome 6 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <!-- Google Fonts: Inter & Amiri -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* ========== RESET & VARIABEL ========== */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --bg-dark: #0a1f3b;
      --bg-medium: #0d2a4a;
      --bg-light: #123b5e;
      --gold: #ffd966;
      --gold-light: #ffeaa5;
      --gold-soft: #ffb74d;
      --blue-magic: #74b9ff;
      --glass-bg: rgba(10, 30, 50, 0.65);
      --glass-border: rgba(255, 245, 200, 0.2);
      --toast-success: #00b894;
      --toast-error: #d63031;
      --shadow-heavy: 0 20px 40px rgba(0,0,0,0.4);
      --transition: all 0.25s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    body {
      background: radial-gradient(circle at 30% 10%, var(--bg-dark), var(--bg-medium), var(--bg-light));
      color: #f0f9ff;
      font-family: 'Inter', sans-serif;
      line-height: 1.5;
      min-height: 100vh;
      padding: 20px;
      position: relative;
      overflow-x: hidden;
    }
    .moon {
      position: fixed; top: 5%; right: 8%;
      width: 200px; height: 200px;
      background: radial-gradient(circle at 35% 35%, #fffde7, #fff9c4, #ffe082);
      border-radius: 50%;
      box-shadow: 0 0 50px 30px rgba(255,243,158,0.6), 0 0 100px 60px rgba(255,235,120,0.3);
      animation: moonBreathing 7s ease-in-out infinite;
      z-index: 1; opacity: 0.8; pointer-events: none;
    }
    @keyframes moonBreathing {
      0% { box-shadow: 0 0 50px 30px rgba(255,243,158,0.6), 0 0 100px 60px rgba(255,235,120,0.3); transform: scale(1); }
      50% { box-shadow: 0 0 70px 40px rgba(255,255,200,0.9), 0 0 140px 80px rgba(255,241,140,0.5); transform: scale(1.02); }
      100% { box-shadow: 0 0 50px 30px rgba(255,243,158,0.6), 0 0 100px 60px rgba(255,235,120,0.3); transform: scale(1); }
    }
    .stars {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none; z-index: 0;
    }
    .stars::after {
      content: ''; position: absolute;
      width: 4px; height: 4px;
      background: white; border-radius: 50%;
      box-shadow: 80px 120px white, 250px 300px rgba(255,255,200,0.9), 600px 180px white, 900px 70px rgba(255,255,210,0.8),
                  1100px 400px white, 200px 600px rgba(255,255,180,0.7), 700px 550px white, 1300px 200px white,
                  300px 800px white, 1000px 700px rgba(255,255,220,0.9), 400px 450px white, 1200px 550px white;
      animation: twinkle 6s infinite alternate;
    }
    @keyframes twinkle { 0% { opacity: 0.5; } 100% { opacity: 1; } }
    .portal-container {
      position: relative; z-index: 30;
      max-width: 1440px; margin: 0 auto;
      background: rgba(10,30,50,0.65);
      backdrop-filter: blur(18px);
      border-radius: 56px;
      padding: 30px 35px;
      box-shadow: var(--shadow-heavy);
      border: 1px solid rgba(255,245,200,0.15);
    }
    /* ===== LOGO IDENTITAS ===== */
    .identity-logo {
      position: absolute; top: 25px; right: 35px;
      width: 56px; height: 56px;
      border-radius: 50%;
      background: rgba(255,255,245,0.15);
      backdrop-filter: blur(8px);
      border: 2px solid rgba(255,215,100,0.5);
      display: flex; justify-content: center; align-items: center;
      overflow: hidden; box-shadow: 0 0 20px rgba(255,220,100,0.4);
      transition: var(--transition); z-index: 40;
    }
    .identity-logo:hover { transform: scale(1.05); border-color: #ffd966; }
    .identity-logo img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .identity-logo i { font-size: 28px; color: var(--gold); }
    /* ===== HEADER ===== */
    .brand { display: flex; align-items: center; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; }
    .logo-container {
      width: 80px; height: 80px; border-radius: 20px;
      background: rgba(255,255,245,0.1); backdrop-filter: blur(8px);
      border: 2px solid var(--gold); display: flex; justify-content: center; align-items: center;
      overflow: hidden; box-shadow: 0 0 20px rgba(255,220,100,0.3);
    }
    #logoPreview { width: 100%; height: 100%; object-fit: cover; display: block; }
    .logo-placeholder { font-size: 42px; color: var(--gold); }
    .title-tagline h1 { font-size: 2rem; font-weight: 700; color: #fffbe3; text-shadow: 0 0 12px rgba(255,235,100,0.5); margin-bottom: 4px; font-family: 'Amiri', serif; }
    .title-tagline p { font-size: 1rem; color: #e6f7ff; background: rgba(0,0,0,0.2); padding: 5px 18px; border-radius: 50px; display: inline-block; border-left: 6px solid var(--gold-soft); }
    /* ===== INFO RAMADHAN ===== */
    .ramadan-info-card {
      background: rgba(0,0,0,0.2); backdrop-filter: blur(6px); border-radius: 60px;
      padding: 12px 25px; margin-top: 15px; display: inline-flex; align-items: center; gap: 15px; flex-wrap: wrap;
      border: 1px solid rgba(255,215,100,0.3);
    }
    .ramadan-info-card span { display: flex; align-items: center; gap: 8px; color: #ffeaa5; }
    .ramadan-info-card i { color: var(--gold); }
    /* ===== INNER TABS ===== */
    .inner-tab-nav { display: flex; gap: 10px; margin: 15px 0 25px; flex-wrap: wrap; }
    .inner-tab-btn {
      background: rgba(0,0,0,0.3); border: 1px solid rgba(255,215,100,0.3);
      padding: 10px 24px; font-size: 0.95rem; font-weight: 500; border-radius: 40px; color: #e2f0ff;
      display: flex; align-items: center; gap: 8px; cursor: pointer; transition: var(--transition);
    }
    .inner-tab-btn.active {
      background: rgba(255,200,100,0.3); color: #fff4c2; border-color: var(--gold);
      box-shadow: 0 0 15px rgba(255,200,0,0.3);
    }
    .inner-tab-content { display: none; }
    .inner-tab-content.active { display: block; }
    /* ===== SAMBUTAN ===== */
    .ramadan-quote {
      background: linear-gradient(145deg, rgba(20,60,85,0.85), rgba(10,45,65,0.95));
      padding: 30px 35px; border-radius: 60px 20px 60px 20px; margin-bottom: 20px;
      border-left: 12px solid var(--gold-soft); backdrop-filter: blur(8px);
    }
    .ramadan-quote h2 { font-size: 2.2rem; font-family: 'Amiri', serif; color: var(--gold-light); margin-bottom: 8px; }
    .ramadan-quote p { font-size: 1.2rem; font-style: italic; color: #f0fff0; }
    .welcome-principal {
      display: flex; gap: 30px; flex-wrap: wrap; background: rgba(25,65,90,0.65); border-radius: 48px;
      padding: 25px; align-items: center; backdrop-filter: blur(8px);
      border: 1px solid rgba(255,200,120,0.3);
    }
    .principal-photo {
      width: 130px; height: 130px; border-radius: 50%;
      background: radial-gradient(circle, #ffe082, #ffb74d);
      display: flex; justify-content: center; align-items: center;
      font-size: 70px; color: #1e3b5a; border: 4px solid var(--gold);
      box-shadow: 0 0 30px #ffd966aa; overflow: hidden;
    }
    .speech { flex: 1; }
    .speech h3 { font-size: 1.8rem; color: #ffddaa; border-bottom: 2px dashed #fff3cd; padding-bottom: 10px; margin-bottom: 15px; }
    .speech p { font-size: 1.1rem; color: #f5f6fa; line-height: 1.7; }
    /* ===== VIDEO TUTORIAL ===== */
    .video-card {
      display: flex; align-items: center; gap: 30px; background: rgba(15,50,70,0.75); border-radius: 36px;
      padding: 20px 30px; flex-wrap: wrap; backdrop-filter: blur(8px);
      border: 1px solid rgba(255,220,100,0.3);
    }
    .video-frame { width: 280px; height: 158px; border-radius: 20px; overflow: hidden; box-shadow: 0 0 0 4px rgba(255,220,100,0.3); }
    .video-frame iframe { width: 100%; height: 100%; border: none; }
    .video-text h4 { font-size: 1.6rem; margin-bottom: 10px; color: #fff2bf; }
    /* ===== CARD GRID ===== */
    .filter-section { display: flex; align-items: center; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; }
    .filter-select {
      background: rgba(10,35,55,0.85); border: 1px solid var(--gold);
      color: white; padding: 10px 25px; border-radius: 40px;
      font-size: 0.95rem; cursor: pointer; transition: var(--transition);
    }
    .class-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 20px; margin-bottom: 25px;
    }
    .class-card {
      background: rgba(0,0,0,0.35); backdrop-filter: blur(8px); border-radius: 28px;
      padding: 20px; border: 1px solid rgba(255,215,100,0.3);
      transition: var(--transition); box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }
    .class-card:hover {
      border-color: var(--gold); background: rgba(0,0,0,0.45); transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.3);
    }
    .class-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 1px dashed rgba(255,215,100,0.5); }
    .class-header h3 { font-size: 1.5rem; font-weight: 700; color: #ffefc0; }
    .class-header i { font-size: 1.8rem; color: var(--gold); }
    .rombel-links-card { display: flex; flex-direction: column; gap: 12px; }
    .rombel-item { display: flex; justify-content: space-between; align-items: center; padding: 6px 0; }
    .rombel-label { font-weight: 600; color: #fbffc4; min-width: 75px; }
    .rombel-actions { display: flex; gap: 12px; }
    .btn-link {
      display: inline-flex; align-items: center; gap: 6px; padding: 6px 16px; border-radius: 30px;
      font-size: 0.85rem; text-decoration: none; font-weight: 500; transition: var(--transition);
    }
    .btn-sheet { background: rgba(70,130,200,0.25); border: 1px solid var(--blue-magic); color: #cfe9ff; }
    .btn-sheet:hover { background: #0984e3; color: white; transform: scale(1.02); }
    .btn-canva { background: rgba(180,70,200,0.25); border: 1px solid #e08eff; color: #e6d0ff; }
    .btn-canva:hover { background: #8e44ad; color: white; transform: scale(1.02); }
    .btn-canva-primary {
      background: radial-gradient(circle at 30% 30%, #ffb347, #ff8c42);
      padding: 16px 50px; border-radius: 60px; font-size: 1.3rem; font-weight: 700; color: #0a1f2e;
      border: 2px solid #ffe99b; box-shadow: 0 0 30px #ffb347cc; display: inline-flex; gap: 15px; align-items: center;
      text-decoration: none; margin: 10px 0; transition: var(--transition);
    }
    .btn-canva-primary:hover { background: radial-gradient(circle at 30% 30%, #ffa233, #ff6b2b); box-shadow: 0 0 50px #ffae42; transform: scale(1.03); }
    /* ===== FOOTER ===== */
    .footer {
      background: rgba(6,25,40,0.85); border-radius: 40px; padding: 25px 30px;
      display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; margin-top: 15px;
      backdrop-filter: blur(8px);
    }
    .footer-logo { display: flex; align-items: center; gap: 15px; }
    .footer-info h4 { font-size: 1.5rem; color: #fff3cd; }
    .social a { color: #ffe9b0; font-size: 28px; margin-left: 20px; transition: var(--transition); display: inline-block; }
    .social a:hover { color: var(--gold); transform: translateY(-4px); }
    .copyright { text-align: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(255,215,100,0.3); color: #c3e6ff; font-size: 0.9rem; }
    /* ===== CANVA EMBED ===== */
    .canva-modal-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.85); backdrop-filter: blur(12px);
      display: flex; justify-content: center; align-items: center;
      z-index: 999999; visibility: hidden; opacity: 0; transition: 0.3s;
    }
    .canva-modal-overlay.active { visibility: visible; opacity: 1; }
    .canva-modal-container {
      width: 90%; height: 85%; max-width: 1200px;
      background: rgba(10,30,45,0.95); backdrop-filter: blur(20px);
      border: 2px solid rgba(255,215,100,0.6); border-radius: 32px;
      display: flex; flex-direction: column; overflow: hidden;
      transform: scale(0.95); transition: transform 0.3s;
    }
    .canva-modal-overlay.active .canva-modal-container { transform: scale(1); }
    .canva-modal-header {
      display: flex; justify-content: space-between; align-items: center;
      padding: 16px 24px; border-bottom: 1px solid rgba(255,215,100,0.3);
    }
    .canva-modal-header h3 { font-family: 'Amiri', serif; color: #ffeaa5; font-size: 1.5rem; display: flex; align-items: center; gap: 10px; }
    .canva-close-btn {
      background: rgba(255,255,255,0.1); border: 1px solid rgba(255,215,100,0.5);
      color: #ffd966; width: 40px; height: 40px; border-radius: 50%;
      display: flex; justify-content: center; align-items: center; font-size: 1.3rem; cursor: pointer; transition: 0.2s;
    }
    .canva-close-btn:hover { background: rgba(255,200,100,0.2); border-color: #ffd966; color: #fff4c2; transform: rotate(90deg); }
    .canva-iframe-wrapper { flex: 1; width: 100%; padding: 20px; position: relative; }
    .canva-iframe-wrapper iframe { width: 100%; height: 100%; border: none; border-radius: 20px; background: white; }
    .canva-loading {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      color: #ffd966; font-size: 1.2rem; display: flex; flex-direction: column; align-items: center; gap: 12px;
    }
    .canva-loading i { font-size: 3rem; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    /* ===== LOADING & ERROR ===== */
    .app-loading, .app-error {
      text-align: center; padding: 50px; color: white;
    }
    .app-loading i { font-size: 3rem; animation: spin 1s linear infinite; margin-bottom: 20px; }
    @media (max-width: 1000px) {
      .portal-container { padding: 20px; }
      .moon { width: 130px; height: 130px; }
      .identity-logo { top: 15px; right: 20px; width: 48px; height: 48px; }
    }
  </style>
</head>
<body>
  <div class="moon"></div>
  <div class="stars"></div>

  <!-- CANVA EMBED MODAL -->
  <div id="canvaModal" class="canva-modal-overlay">
    <div class="canva-modal-container">
      <div class="canva-modal-header">
        <h3><i class="fab fa-canva"></i> Canva e‚ÄëJurnal Ramadan</h3>
        <div class="canva-close-btn" id="closeCanvaModal"><i class="fas fa-times"></i></div>
      </div>
      <div class="canva-iframe-wrapper">
        <div id="canvaLoading" class="canva-loading"><i class="fas fa-circle-notch"></i><span>Memuat desain Canva...</span></div>
        <iframe id="canvaIframe" src="about:blank" allowfullscreen style="display: none;"></iframe>
      </div>
    </div>
  </div>

  <div id="appRoot" class="portal-container" style="display: none;">
    <!-- Akan diisi oleh JavaScript -->
  </div>

  <script>
    (function() {
      'use strict';

      // üîÅ ========== [ GANTI URL INI DENGAN URL PUBLISH GOOGLE SHEETS ANDA ] ==========
      const SHEET_JSON_URL = 'https://spreadsheets.google.com/feeds/list/1xJ_6k8D7c7zQy9UqWm0VnXr5zL3tHfGpP/od6/public/values?alt=json';
      // üîº GANTI DENGAN URL PUBLISH ANDA!

      // Default values jika sheet gagal dimuat
      const DEFAULTS = {
        school_name: 'e-Jurnal Ramadan',
        school_tagline: '‚ú® Cahaya Ilmu di Bulan Suci ‚ú®',
        principal_name: 'Kepala Sekolah',
        principal_icon: 'fas fa-user-tie',
        speech: 'Selamat menunaikan ibadah puasa. Mari kita isi Ramadan dengan kebaikan.',
        youtube_id: 'VIDEO_ID',
        footer_school: 'SDIT Al-Falah',
        footer_tagline: 'Bersama Raih Berkah Ramadan',
        footer_address: 'Jl. Luminous No. 9, Jakarta',
        copyright_text: '¬© SDIT Al-Falah 2026',
        ramadan_start: '2026-03-01',
        ig_url: '#',
        fb_url: '#',
        yt_url: '#',
        tiktok_url: '#',
        main_canva_url: 'https://www.canva.com/ramadan',
        identity_logo: null,
        identity_icon: 'fas fa-star'
      };

      // Data untuk 24 rombel
      const KELAS_LIST = [1,2,3,4,5,6];
      const HURUF_ROMBEL = ['A','B','C','D'];

      let appData = { ...DEFAULTS };
      let sheetLinks = {
        gsheet: {},
        canva: {}
      };

      // Elemen root
      const appRoot = document.getElementById('appRoot');
      const loadingDiv = document.createElement('div');
      loadingDiv.className = 'app-loading';
      loadingDiv.innerHTML = '<i class="fas fa-circle-notch"></i><p>Memuat portal e-Jurnal Ramadan...</p>';
      document.body.appendChild(loadingDiv);

      // ========== FETCH DATA DARI GOOGLE SHEETS ==========
      async function fetchSheetData() {
        try {
          const response = await fetch(SHEET_JSON_URL);
          if (!response.ok) throw new Error('Network error');
          const data = await response.json();
          
          // Parse feed
          const entries = data.feed.entry || [];
          entries.forEach(entry => {
            const key = entry.title?.$t;
            const value = entry.content?.$t || '';
            if (!key) return;

            // Mapping ke appData atau sheetLinks
            if (key.startsWith('class_')) {
              // format: class_1A_sheet, class_1A_canva, etc.
              const parts = key.split('_');
              if (parts.length === 3) {
                const kelasHuruf = parts[1]; // contoh "1A"
                const type = parts[2]; // "sheet" atau "canva"
                if (type === 'sheet') sheetLinks.gsheet[kelasHuruf] = value || '#';
                if (type === 'canva') sheetLinks.canva[kelasHuruf] = value || '#';
              }
            } else {
              // Data umum
              appData[key] = value || DEFAULTS[key] || '';
            }
          });

          // Fallback untuk link yang tidak ada
          KELAS_LIST.forEach(k => {
            HURUF_ROMBEL.forEach(h => {
              const key = `${k}${h}`;
              if (!sheetLinks.gsheet[key]) sheetLinks.gsheet[key] = '#';
              if (!sheetLinks.canva[key]) sheetLinks.canva[key] = '#';
            });
          });

          renderApp();
          loadingDiv.style.display = 'none';
          appRoot.style.display = 'block';
        } catch (error) {
          console.error('Gagal memuat data dari Google Sheets:', error);
          // Gunakan default dan render
          renderApp();
          loadingDiv.style.display = 'none';
          appRoot.style.display = 'block';
        }
      }

      // ========== RENDER APLIKASI ==========
      function renderApp() {
        const html = `
          <!-- LOGO IDENTITAS -->
          <div id="identityLogoContainer" class="identity-logo">
            ${appData.identity_logo 
              ? `<img src="${appData.identity_logo}" alt="logo identitas">`
              : `<i class="${appData.identity_icon || 'fas fa-star'}"></i>`
            }
          </div>

          <!-- HEADER -->
          <div class="brand">
            <div class="logo-container">
              <div class="logo-placeholder"><i class="fas fa-mosque"></i></div>
            </div>
            <div class="title-tagline">
              <h1 id="schoolTitle">${appData.school_name || DEFAULTS.school_name}</h1>
              <p id="tagline">${appData.school_tagline || DEFAULTS.school_tagline}</p>
            </div>
          </div>

          <!-- INNER TABS -->
          <div class="inner-tab-nav">
            <button class="inner-tab-btn active" id="tabSambutan"><i class="fas fa-star"></i> Sambutan</button>
            <button class="inner-tab-btn" id="tabTutorial"><i class="fas fa-video"></i> Tutorial</button>
            <button class="inner-tab-btn" id="tabAkses"><i class="fas fa-users"></i> User Siswa & Ortu</button>
            <button class="inner-tab-btn" id="tabProfil"><i class="fas fa-address-card"></i> Profil Sekolah</button>
          </div>

          <!-- KONTEN -->
          <div id="contentSambutan" class="inner-tab-content active">
            <div class="ramadan-quote">
              <h2>üåô Marhaban Ya Ramadan</h2>
              <p>"Bulan yang penuh berkah, pintu ampunan terbuka lebar. Mari isi dengan e-Jurnal kebaikan."</p>
              <div id="ramadanInfo" class="ramadan-info-card">
                ${renderRamadanInfo(appData.ramadan_start)}
              </div>
            </div>
            <div class="welcome-principal">
              <div class="principal-photo">
                <div style="font-size:70px;"><i class="${appData.principal_icon || 'fas fa-user-tie'}"></i></div>
              </div>
              <div class="speech">
                <h3>Sambutan Kepala Sekolah</h3>
                <p>${appData.speech || DEFAULTS.speech}</p>
                <p style="margin-top: 12px;"><strong>‚Äì ${appData.principal_name || DEFAULTS.principal_name}</strong></p>
              </div>
            </div>
          </div>

          <div id="contentTutorial" class="inner-tab-content">
            <div class="video-card">
              <div class="video-frame">
                <iframe src="https://www.youtube.com/embed/${appData.youtube_id || DEFAULTS.youtube_id}?controls=1&rel=0" allowfullscreen></iframe>
              </div>
              <div class="video-text">
                <h4>Tutorial Penggunaan APP</h4>
                <p>Panduan lengkap e-Jurnal untuk guru, siswa & ortu.</p>
                <span style="color: #ffeaa5;"><i class="fas fa-video"></i> Klik putar untuk menonton</span>
              </div>
            </div>
          </div>

          <div id="contentAkses" class="inner-tab-content">
            <div class="filter-section">
              <label><i class="fas fa-filter"></i> Filter Kelas:</label>
              <select id="filterKelas" class="filter-select">
                <option value="all">Semua Kelas</option>
                <option value="1">Kelas 1</option>
                <option value="2">Kelas 2</option>
                <option value="3">Kelas 3</option>
                <option value="4">Kelas 4</option>
                <option value="5">Kelas 5</option>
                <option value="6">Kelas 6</option>
              </select>
            </div>
            <div id="classGridContainer" class="class-grid">
              ${renderClassGrid('all')}
            </div>
            <div style="text-align: center;">
              <a href="${appData.main_canva_url || '#'}" id="mainCanvaLink" class="btn-canva-primary" target="_blank">
                <i class="fab fa-canva"></i> Aplikasi Utama Canva
              </a>
            </div>
          </div>

          <div id="contentProfil" class="inner-tab-content">
            <footer class="footer" style="margin-top:0;">
              <div class="footer-logo">
                <i class="fas fa-mosque" style="font-size: 50px; color: #ffe087;"></i>
                <div class="footer-info">
                  <h4>${appData.footer_school || DEFAULTS.footer_school}</h4>
                  <span>${appData.footer_tagline || DEFAULTS.footer_tagline}</span>
                  <span><i class="fas fa-map-marker-alt"></i> ${appData.footer_address || DEFAULTS.footer_address}</span>
                </div>
              </div>
              <div class="social">
                <a href="${appData.ig_url || '#'}" target="_blank"><i class="fab fa-instagram"></i></a>
                <a href="${appData.fb_url || '#'}" target="_blank"><i class="fab fa-facebook"></i></a>
                <a href="${appData.yt_url || '#'}" target="_blank"><i class="fab fa-youtube"></i></a>
                <a href="${appData.tiktok_url || '#'}" target="_blank"><i class="fab fa-tiktok"></i></a>
              </div>
            </footer>
            <div class="copyright">${appData.copyright_text || DEFAULTS.copyright_text}</div>
          </div>
        `;

        appRoot.innerHTML = html;

        // Aktifkan tab
        const tabBtns = {
          tabSambutan: 'contentSambutan',
          tabTutorial: 'contentTutorial',
          tabAkses: 'contentAkses',
          tabProfil: 'contentProfil'
        };
        for (let [btnId, contentId] of Object.entries(tabBtns)) {
          document.getElementById(btnId).addEventListener('click', function() {
            Object.values(tabBtns).forEach(id => document.getElementById(id).classList.remove('active'));
            document.getElementById(contentId).classList.add('active');
            document.querySelectorAll('.inner-tab-btn').forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
          });
        }

        // Filter kelas
        const filterSelect = document.getElementById('filterKelas');
        const gridContainer = document.getElementById('classGridContainer');
        filterSelect.addEventListener('change', function(e) {
          gridContainer.innerHTML = renderClassGrid(e.target.value);
        });

        // Canva embed
        attachCanvaListeners();
      }

      // ========== RENDER CARD GRID ==========
      function renderClassGrid(filterKelas = 'all') {
        let html = '';
        KELAS_LIST.forEach(kelas => {
          if (filterKelas !== 'all' && kelas != filterKelas) return;
          html += `<div class="class-card">
            <div class="class-header"><h3>Kelas ${kelas}</h3><i class="fas fa-users"></i></div>
            <div class="rombel-links-card">`;
          HURUF_ROMBEL.forEach(huruf => {
            const key = `${kelas}${huruf}`;
            const sheetLink = sheetLinks.gsheet[key] || '#';
            const canvaLink = sheetLinks.canva[key] || '#';
            html += `<div class="rombel-item">
              <span class="rombel-label">Kelas ${key}</span>
              <div class="rombel-actions">
                <a href="${sheetLink}" class="btn-link btn-sheet" target="_blank"><i class="fas fa-file-excel"></i> Sheet</a>
                <a href="${canvaLink}" class="btn-link btn-canva" target="_blank"><i class="fab fa-canva"></i> Canva</a>
              </div>
            </div>`;
          });
          html += `</div></div>`;
        });
        return html;
      }

      // ========== RENDER INFO RAMADHAN ==========
      function renderRamadanInfo(startDateStr) {
        if (!startDateStr) startDateStr = DEFAULTS.ramadan_start;
        const startDate = new Date(startDateStr + 'T12:00:00');
        const today = new Date();
        today.setHours(0,0,0,0);
        const diffTime = today - startDate;
        const diffDays = Math.floor(diffTime / (1000*60*60*24)) + 1;
        const formatted = startDate.toLocaleDateString('id-ID', { day:'numeric', month:'long', year:'numeric' });
        let html = `<span><i class="fas fa-calendar-alt"></i> 1 Ramadhan 1446 H: ${formatted}</span>`;
        if (diffDays > 0) {
          html += `<span><i class="fas fa-moon"></i> Hari ke-${diffDays} Ramadhan 1446 H</span>`;
        } else {
          html += `<span><i class="fas fa-moon"></i> Menjelang Ramadhan 1446 H</span>`;
        }
        return html;
      }

      // ========== CANVA EMBED ==========
      function attachCanvaListeners() {
        const canvaModal = document.getElementById('canvaModal');
        const canvaIframe = document.getElementById('canvaIframe');
        const canvaLoading = document.getElementById('canvaLoading');
        const closeBtn = document.getElementById('closeCanvaModal');

        function buildCanvaEmbedUrl(url) {
          if (!url || url === '#') return null;
          try {
            if (url.includes('/embed')) return url;
            const designMatch = url.match(/(https:\/\/[^\/]+\/design\/[^\/?#]+)/i);
            if (designMatch) {
              let base = designMatch[1];
              base = base.replace(/\/[^\/]+$/, '');
              return `${base}/embed?referer=e-jurnal-ramadan`;
            }
            return url.endsWith('/') ? `${url}embed` : `${url}/embed`;
          } catch (e) { return null; }
        }

        function openCanvaEmbed(originalUrl) {
          const embedUrl = buildCanvaEmbedUrl(originalUrl);
          if (!embedUrl) { window.open(originalUrl, '_blank'); return; }
          canvaLoading.style.display = 'flex';
          canvaIframe.style.display = 'none';
          canvaIframe.src = embedUrl;
          canvaModal.classList.add('active');
          document.body.style.overflow = 'hidden';
          canvaIframe.onload = () => {
            canvaLoading.style.display = 'none';
            canvaIframe.style.display = 'block';
          };
        }

        function closeCanvaEmbed() {
          canvaModal.classList.remove('active');
          document.body.style.overflow = '';
          setTimeout(() => { if (!canvaModal.classList.contains('active')) canvaIframe.src = 'about:blank'; }, 300);
        }

        closeBtn.addEventListener('click', closeCanvaEmbed);
        canvaModal.addEventListener('click', e => { if (e.target === canvaModal) closeCanvaEmbed(); });
        document.addEventListener('keydown', e => { if (e.key === 'Escape' && canvaModal.classList.contains('active')) closeCanvaEmbed(); });

        document.querySelectorAll('.btn-canva').forEach(btn => {
          btn.addEventListener('click', function(e) {
            e.preventDefault();
            openCanvaEmbed(this.href);
          });
        });

        const mainCanva = document.getElementById('mainCanvaLink');
        if (mainCanva) {
          mainCanva.addEventListener('click', function(e) {
            e.preventDefault();
            openCanvaEmbed(this.href);
          });
        }
      }

      // Jalankan fetch data
      fetchSheetData();
    })();
  </script>
</body>
</html>
